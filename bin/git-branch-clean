#!/bin/sh

# Ideas taken from SO answer:
# * better grep for 'master'
# * never try to delete the active branch (was part of the master check)
# * dropped -n1 arg from xargs (not needed), keep xargs to combine lines
# http://stackoverflow.com/questions/6127328/how-can-i-delete-all-git-branches-which-have-been-merged

# gnu xargs has `-r, --no-run-if-empty` (BSD does not...)
MERGED=$(git branch --merged master | grep -v "\bmaster\b\|\*")
if [ -n "${MERGED}" ]; then
  echo "${MERGED}" | xargs git branch -d
fi

set -f # Disable glob expansion (I WANT brace expansion)
git branch --list {deployable,staging}.* | grep -v "\*" | xargs git branch -D
